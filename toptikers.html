<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Добро пожаловать!</title>
    <link rel="stylesheet" href="css/toptikers.css" type="text/css" media="all" />
    <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.10.4/gsap.min.js"></script>
    
    <style>
        body {
            font-family: 'Nunito Sans', sans-serif;
        }
    </style>
</head>
<body>
    <header>
        <a href="main.html" id="header-link">
            <img src="images/tsini.png">
        </a>
        <h3 class="header-title">Топ тикеры</h3>
    </header>
    <div class="main-info">
        <form id="tickerForm">
            <div id="tickerInfo"></div>
            <div class="main-form">
                <button id="submitButton" class="main-btn">Обновить тикер</button>
                <p>Последнее обновление - <span id="lastUpdate"></span></p>
            </div>
        </form>
        <div class="transactions-info">
            <div class="transactions-info_header">
                <p>ТОП 5 по объёму</p>
            </div>
            <div class="transactions-info_main">
                <!-- Данные будут загружены сюда -->
            </div>
        </div>

        <div class="transactions-info">
            <div class="transactions-info_header">
                <p>ТОП 5 по фандингу (отрицательные)</p>
            </div>
            <div class="transactions-info_main">
                <!-- Данные будут загружены сюда -->
            </div>
        </div>

        <div class="transactions-info">
            <div class="transactions-info_header">
                <p>ТОП 5 по фандингу (положительные)</p>
            </div>
            <div class="transactions-info_main">
                <!-- Данные будут загружены сюда -->
            </div>
        </div>
    </div>
    <footer>
        <a href="setting.html" class="footer-link">
            <img src="images/setting_icon.png">
        </a>
        <a href="main.html" class="footer-link">
            <img class="active-btn" src="images/home.png">
        </a>
        <a href="profile.html" class="footer-link">
            <img src="images/profile_icon.png">
        </a>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.10.4/gsap.min.js"></script>
    <script>
        // Анимация перехода при клике на ссылку в заголовке
        const headerLink = document.getElementById('header-link');

        headerLink.addEventListener('click', function(e) {
            e.preventDefault();
            const nextPage = this.getAttribute('href');

            gsap.to('body', {
                x: '200%', // Сдвиг тела влево за пределы видимости
                opacity: 0, // Затухание текущей страницы
                duration: 0.5,
                onComplete: function() {
                    window.location.href = nextPage; // Переход на следующую страницу
                }
            });
        });

        // Анимация перехода для ссылок в футере
        function animatePageTransition(url, useAnimation = true) {
            if (useAnimation) {
                const transitionOut = gsap.timeline({
                    onComplete: () => {
                        window.location.href = url;
                    }
                });
                transitionOut.to("body", { opacity: 0, duration: 0.5 });
            } else {
                window.location.href = url; // Без анимации
            }
        }

        function animatePageEnter() {
            gsap.from("body", { opacity: 0, duration: 0.5 });
        }

        document.addEventListener('DOMContentLoaded', function() {
            animatePageEnter();

            // Обработка кликов по ссылкам в футере
            document.querySelectorAll('.footer-link').forEach(link => {
                link.addEventListener('click', function(event) {
                    event.preventDefault();
                    const targetUrl = this.getAttribute('href');
                    animatePageTransition(targetUrl);
                });
            });

            // Запрос к API для получения данных
            fetch('https://http://127.0.0.1:8000/api/tickers', {
                headers: {
                    'ngrok-skip-browser-warning': 'true',
                }
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok ' + response.statusText);
                }
                return response.json();
            })
            .then(data => {
                if (!data.topVolume || !data.negativeFunding || !data.positiveFunding) {
                    throw new Error('Data format is incorrect');
                }

                const containerTopVolume = document.querySelector('.transactions-info:nth-of-type(1) .transactions-info_main');
                const containerNegativeFunding = document.querySelector('.transactions-info:nth-of-type(2) .transactions-info_main');
                const containerPositiveFunding = document.querySelector('.transactions-info:nth-of-type(3) .transactions-info_main');

                containerTopVolume.innerHTML = '';  // Очистка контейнера
                containerNegativeFunding.innerHTML = '';  // Очистка контейнера
                containerPositiveFunding.innerHTML = '';  // Очистка контейнера

                data.topVolume.forEach(item => {
                    const p = document.createElement('p');
                    const spanName = document.createElement('span');
                    const spanValue = document.createElement('span');
                    
                    spanName.textContent = item.ticker + ':';
                    spanValue.textContent = item.volume + '$';

                    p.appendChild(spanName);
                    p.appendChild(spanValue);
                    containerTopVolume.appendChild(p);
                });

                data.negativeFunding.forEach(item => {
                    const p = document.createElement('p');
                    const spanName = document.createElement('span');
                    const spanValue = document.createElement('span');

                    spanName.textContent = item.ticker + ':';
                    spanValue.textContent = item.volume + '$';

                    p.appendChild(spanName);
                    p.appendChild(spanValue);
                    containerNegativeFunding.appendChild(p);
                });

                data.positiveFunding.forEach(item => {
                    const p = document.createElement('p');
                    const spanName = document.createElement('span');
                    const spanValue = document.createElement('span');

                    spanName.textContent = item.ticker + ':';
                    spanValue.textContent = item.volume + '$';

                    p.appendChild(spanName);
                    p.appendChild(spanValue);
                    containerPositiveFunding.appendChild(p);
                });

                // Обновление времени последнего обновления
                const lastUpdate = document.getElementById('lastUpdate');
                lastUpdate.textContent = new Date().toLocaleString();
            })
            .catch(error => {
                console.error('There has been a problem with your fetch operation:', error);
                const containers = document.querySelectorAll('.transactions-info_main');
                containers.forEach(container => {
                    container.innerHTML = '<p>Failed to load data</p>';
                });
            });
        });
    </script>
</body>
</html>
